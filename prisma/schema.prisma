generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  fullname   String
  phone      String   @unique @db.VarChar(15)
  role       UserRole @default(USER)
  city       String?
  province   String?
  zip_code   String?
  password   String?
  avatar     String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  otp Otp[]
  ads Ad[]
  favorited_ads Ad[] @relation("UserFavoritedAds")

  @@map("users")
}

model Otp {
  id         String   @id @default(cuid())
  code       String
  expires_at DateTime
  used       Boolean  @default(false)

  user_id String
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("otps")
}

model Category {
  id          String   @id @default(cuid())
  name        String
  image       String?
  description String?
  created_at  DateTime @default(now())

  subcategories Subcategory[]
  ads           Ad[]

  @@map("categories")
}

model Subcategory {
  id          String   @id @default(cuid())
  name        String
  image       String?
  description String?
  created_at  DateTime @default(now())

  category_id String
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  ads         Ad[]

  @@unique([category_id, name])
  @@map("subcategories")
}

model Car {
  id String @id @default(cuid())

  mark           String
  mileage        String
  exterior_color String

  brand          String?
  model          String?
  body_type      String?
  fuel_type      String?
  interior_color String?
  seats_material String?
  body_condition String?
  cylinders      String?
  transmission   String?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  ad Ad?

  @@map("cars")
}

model Media {
  id         String   @id @default(cuid())
  url        String
  type       String
  created_at DateTime @default(now())

  ad_id String
  ad    Ad     @relation(fields: [ad_id], references: [id])

  @@map("media")
}

model Location {
  id       String @id @default(cuid())
  district String
  area     String
  block    String

  ad Ad?

  @@map("location")
}

model Ad {
  id                String  @id @default(cuid())
  title             String?
  description       String? @db.Text
  year              Int?
  price             Int?
  additional_number String?

  car_id String? @unique
  car    Car?    @relation(fields: [car_id], references: [id])

  location_id String   @unique
  location    Location @relation(fields: [location_id], references: [id])

  thumbnail String
  media     Media[]

  category_id    String
  subcategory_id String
  category       Category    @relation(fields: [category_id], references: [id])
  subcategory    Subcategory @relation(fields: [subcategory_id], references: [id])

  user_id String
  user    User   @relation(fields: [user_id], references: [id])
  favorited_by User[] @relation("UserFavoritedAds")

  created_at DateTime @default(now())

  @@map("ads")
}

enum UserRole {
  ADMIN
  USER
  ANONYMOUS
}

// enum PLAN {
//   BASIC
//   STANDARD
//   PRO
// }
